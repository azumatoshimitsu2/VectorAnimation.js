{"version":3,"file":"sample.js","sources":["../src/modules/Vector.js","../src/modules/dispatchEvent.js","../src/modules/VectorAnimation.js","../src/sample.js"],"sourcesContent":["export default class Vector {\n  static add(v1, v2) {\n    x = v1.x + v2.x;\n    y = v1.y + v2.y;\n    return {x: x, y: y};\n  }\n  static sub(v1, v2) {\n    x = v1.x - v2.x;\n    y = v1.y - v2.y;\n    return {x: x, y: y};\n  }\n  static mult(v, n) {\n    x = v.x * n;\n    y = v.y * n;\n    return {x: x, y: y};\n  }\n  static div(v, n) {\n    x = v.x / n;\n    y = v.y / n;\n    return {x: x, y: y};\n  }\n  static normalize(v) {\n    var m = this.mag(v);\n    if(m !== 0) {\n      return this.div(v, m);\n    } else {\n      return v;\n    }\n  }\n  static mag(v) {\n    return Math.sqrt(v.x * v.x + v.y * v.y);\n  }\n};\n","export default function(el, event){\n  if (document.createEvent) {\n    var evt = document.createEvent(\"HTMLEvents\");\n    evt.initEvent(event, true, true );\n    return el.dispatchEvent(evt);\n  } else {\n    var evt = document.createEventObject();\n    return el.fireEvent(\"on\" + event, evt)\n  }\n};\n","import Vector from './Vector.js';\nimport dispatchEvent from './dispatchEvent.js';\n\nexport default class VectorAnimation {\n\n  constructor(arg) {\n    if(!arg) {\n    \tthrow new Error('argments required. 引数は必須です');\n    }\n    this.el                     = arg.el || document.querySelector('body');\n    this.stageId                = arg.stageId;\n    this.location               = (arg.location)? arg.location : { x: 0, y: 0 },\n    this.friction               = arg.friction || 0.9,\n    this.velocity               = { x: 0, y: 0 },\n    this.acceleration           = { x: 0, y: 0 },\n    this.mass                   = arg.mass || 10,\n    this.maxspeed               = arg.maxspeed || 10,\n    this.minspeed               = arg.minspeed || 2.8;\n    this.damage                 = arg.damage || 0.98,\n    this.gravDistance           = arg.gravDistance || 100;\n    this.gravityPoints          = arg.gravityPoints || {};\n    this.currentGPointNum       = 0;\n    this.showGravityPointsColor = arg.showGravityPointsColor;\n    this.isAnimationEnd         = false;\n    this.infinity               = arg.infinity || false;\n  }\n\n  draw() {\n    return this;\n  }\n\n  update() {\n    this.velocity     = Vector.add(this.velocity, this.acceleration);\n    this.velocity     = Vector.mult(this.velocity, this.damage);\n    this.location     = Vector.add(this.location, this.velocity);\n    this.acceleration = Vector.mult(this.acceleration, 0);\n    return this;\n  }\n\n  applyForce(force) {\n    force = Vector.div(force, this.mass);\n    this.acceleration = Vector.add(this.acceleration, force);\n    return this;\n  }\n\n  seek(obj) {\n    let arg       = obj || {};\n    let g         = arg.g || this.gravityPoints[this.currentGPointNum].g;\n    let direction = (arg.x && arg.y)? { x: arg.x, y: arg.y } : this.gravityPoints[this.currentGPointNum].pos;\n    let sub       = Vector.sub(direction, this.location);\n    let normal    = Vector.normalize(sub);\n    let force     = Vector.mult(normal, g);\n    this.applyForce(force);\n  }\n\n  arrive(arg) {\n  \tlet gPoint  = this.gravityPoints[this.currentGPointNum];\n  \tlet sub     = Vector.sub(gPoint.pos, this.location);\n  \tlet diff    = Vector.mag(sub);\n  \tlet normal  = Vector.normalize(sub);\n  \tlet desired = { x: 0, y: 0 };\n  \tlet steer   = { x: 0, y: 0 };\n\n  \tif(diff < this.gravDistance) {\n  \t  let isNextPoint = (this.gravityPoints.length - 1 > this.currentGPointNum)? true : false;\n  \t  let mapedScalar = this.minspeed;\n\n  \t  if(isNextPoint) {\n  \t    this.currentGPointNum += 1;\n  \t    this.acceleration      = { x: 0, y: 0 };\n  \t  }\n  \t  else if(this.infinity) {\n  \t    console.log('infinity')\n  \t    this.currentGPointNum = 0;\n  \t    this.acceleration     = { x: 0, y: 0 };\n  \t  } else {\n  \t    mapedScalar = this.map(diff, 0, this.gravDistance, 0, 4);\n  \t  }\n\n  \t  desired = Vector.mult(normal, mapedScalar);\n  \t  steer   = Vector.sub(desired, this.velocity);\n  \t  this.applyForce(steer);\n\n  \t  if(!this.isAnimationEnd && Vector.mag(sub) < 1) {\n  \t    this.isAnimationEnd = true;\n  \t    gPoint.callback(this);\n  \t    dispatchEvent(this.el, 'moveEnd');\n  \t  }\n  \t} else {\n  \t  this.seek();\n  \t}\n  }\n\n  getPoint() {\n    let prop = { x: this.location.x, y: this.location.y };\n    return prop;\n  }\n  //値を規制\n  map(value, low1, high1, low2, high2) {\n    let moto = high1 - low1;\n    let ato  = high2 - low2;\n    return (ato / moto) * value;\n  }\n\n  showGravityPoints() {\n    let stage = document.getElementById(this.stageId);\n    this.gravityPoints.forEach( (v, i) => {\n      let gcolor = this.showGravityPointsColor;\n      let color  = (gcolor)? gcolor : '#000';\n      let div    = document.createElement('div');\n      div.appendChild(document.createTextNode(i));\n      div.style.backgroundColor = color;\n      div.style.position        = 'absolute';\n      div.style.left            = v.pos.x + 'px';\n      div.style.top             = v.pos.y + 'px';\n      div.style.width           = '20px';\n      div.style.height          = '20px';\n      div.style.lineHeight      = '20px';\n      div.style.color           = '#fff';\n      div.style.textAlign       = 'center';\n      stage.appendChild(div);\n    } );\n  }\n}\n","import VectorAnimation from './modules/VectorAnimation.js';\n\n(function() {\n  var timer = {};\n  var el  = document.querySelector('.thing');\n  var el2 = document.querySelector('.thing2');\n  var el3 = document.querySelector('.thing3');\n  var elStyle = el.style;\n  var el2Style = el2.style;\n  var el3Style = el3.style;\n  var callback = function(e) { console.log(e); }\n  var gPoints = [\n        { pos : { x: 300, y: 300 } , g : 1.0, mass : 10, minspeed : 4.0, callback : callback },\n        { pos : { x: 30,  y: 200 } , g : 1.0, mass : 20, minspeed : 1.8, callback : callback },\n        { pos : { x: 330, y: 100 } , g : 1.0, mass : 40, minspeed : 1.8, callback : callback }\n      ];\n  var things = [];\n\n  things.push( new VectorAnimation(\n    {\n      el : el,\n      stageId       : 'stage',\n      location      : { x: 100, y: 100 },\n      gravityPoints : gPoints,\n      gravDistance  : 140,\n      infinity      : true\n    })\n  );\n\n  things.push( new VectorAnimation(\n    {\n      stageId                : 'stage',\n      location               : { x: 200, y: 200 },\n      showGravityPointsColor : '#0f0',\n      gravityPoints : [\n        { pos: { x: 100, y: 100 }, g: 1, callback: callback }\n      ],\n    })\n  );\n\n  things.push( new VectorAnimation(\n    {\n      stageId                : 'stage',\n      location               : { x: 100, y: 100 },\n      showGravityPointsColor : '#00f',\n      gravityPoints          : [ { pos: { x: 400, y: 100 }, g: 1, callback: callback } ]\n    })\n  );\n\n  things.forEach( (v, i) => {\n    v.showGravityPoints();\n    console.log(v.el)\n    console.log(v.stageId)\n    console.log(v.currentGPointNum)\n  });\n\n  el.addEventListener('moveEnd', function(e) {\n    console.log('move end');\n  });\n\n  function loop() {\n    for(var i = 0; i < things.length; i++) {\n      if(i == 0) {\n        things[i].arrive();\n        var pos = things[i].update().getPoint();\n        elStyle.left = pos.x + 'px';\n        elStyle.top  = pos.y + 'px';\n      }\n      else if(i == 1) {\n        things[i].seek();\n        var pos = things[i].update().getPoint();\n        el2Style.left = pos.x + 'px';\n        el2Style.top  = pos.y + 'px';\n      }\n      else {\n        things[i].arrive();\n        var pos = things[i].update().getPoint();\n        el3Style.left = pos.x + 'px';\n        el3Style.top  = pos.y + 'px';\n      }\n    }\n\n    window.requestAnimationFrame(loop);\n  }\n\n  requestAnimationFrame(loop);\n\n})();\n"],"names":["Vector","v1","v2","x","y","v","n","m","this","mag","div","Math","sqrt","el","event","document","createEvent","evt","initEvent","dispatchEvent","createEventObject","fireEvent","VectorAnimation","arg","Error","querySelector","stageId","location","friction","velocity","acceleration","mass","maxspeed","minspeed","damage","gravDistance","gravityPoints","currentGPointNum","showGravityPointsColor","isAnimationEnd","infinity","add","mult","force","obj","g","direction","pos","sub","normal","normalize","applyForce","gPoint","diff","desired","steer","isNextPoint","length","mapedScalar","console","log","map","callback","seek","value","low1","high1","low2","high2","stage","getElementById","forEach","i","gcolor","_this","color","createElement","appendChild","createTextNode","style","backgroundColor","position","left","top","width","height","lineHeight","textAlign","e","el2","el3","elStyle","el2Style","el3Style","gPoints","things","push","showGravityPoints","addEventListener","requestAnimationFrame","loop","arrive","update","getPoint","window"],"mappings":"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"}