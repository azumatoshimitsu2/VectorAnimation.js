{"version":3,"file":"sample.js","sources":["../src/modules/Vector.js","../src/modules/dispatchEvent.js","../src/modules/VectorAnimation.js","../src/sample.js"],"sourcesContent":["export default class Vector {\n\tstatic add(v1, v2) {\n\t\tx = v1.x + v2.x;\n\t\ty = v1.y + v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic sub(v1, v2) {\n\t\tx = v1.x - v2.x;\n\t\ty = v1.y - v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic mult(v, n) {\n\t\tx = v.x * n;\n\t\ty = v.y * n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic div(v, n) {\n\t\tx = v.x / n;\n\t\ty = v.y / n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic normalize(v) {\n\t\tvar m = this.mag(v);\n\t\tif(m !== 0) {\n\t\t\treturn this.div(v, m);\n\t\t} else {\n\t\t\treturn v;\n\t\t}\n\t}\n\tstatic mag(v) {\n\t\treturn Math.sqrt(v.x * v.x + v.y * v.y);\n\t}\n};","export default function(el, event){\n\tif (document.createEvent) {\n\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\t\tevt.initEvent(event, true, true );\n\t\treturn el.dispatchEvent(evt);\n\t} else {\n\t\tvar evt = document.createEventObject();\n\t\treturn el.fireEvent(\"on\" + event, evt)\n\t}\n};\n","import Vector from './Vector.js';\nimport dispatchEvent from './dispatchEvent.js';\n\nexport default class VectorAnimation {\n\n\tconstructor(arg) {\n\t\tif(!arg) {\n\t\t\tthrow new Error('argments required. 引数は必須です');\n\t\t}\n\t\tthis._el                     = arg.el || document.querySelector('body');\n\t\tthis._stageId                = arg.stageId;\n\t\tthis._location               = (arg.location)? arg.location : { x: 0, y: 0 },\n\t\tthis._friction               = arg.friction || 0.9,\n\t\tthis._velocity               = { x: 0, y: 0 },\n\t\tthis._acceleration           = { x: 0, y: 0 },\n\t\tthis._mass                   = arg.mass || 10,\n\t\tthis._maxspeed               = arg.maxspeed || 10,\n\t\tthis._minspeed               = arg.minspeed || 2.8;\n\t\tthis._damage                 = arg.damage || 0.98,\n\t\tthis._gravDistance           = arg.gravDistance || 100;\n\t\tthis._gravityPoints          = arg.gravityPoints || {};\n\t\tthis._currentGPointNum       = 0;\n\t\tthis._showGravityPointsColor = arg.showGravityPointsColor;\n\t\tthis._isAnimationEnd         = false;\n\t\tthis._infinity               = arg.infinity || false;\n\t}\n\n\tget el() {\n\t\treturn this._el;\n\t}\n\n\tget stageId() {\n\t\treturn this._stageId;\n\t}\n\n\tget currentGPointNum() {\n\t\treturn this._currentGPointNum;\n\t}\n\n\tset currentGPointNum(num) {\n\t\tthis._currentGPointNum = num;\n\t}\n\n\tget isAnimationEnd() {\n\t\treturn this._isAnimationEnd;\n\t}\n\n\tset isAnimationEnd(bool) {\n\t\tthis._isAnimationEnd = bool;\n\t}\n\n\tdraw() {\n\t\treturn this;\n\t}\n\n\tupdate() {\n\t    this._velocity     = Vector.add(this._velocity, this._acceleration);\n\t    this._velocity     = Vector.mult(this._velocity, this._damage);\n\t    this._location     = Vector.add(this._location, this._velocity);\n\t    this._acceleration = Vector.mult(this._acceleration, 0);\n\t\treturn this;\n\t}\n\n\tapplyForce(force) {\n\t\tforce = Vector.div(force, this._mass);\n\t\tthis._acceleration = Vector.add(this._acceleration, force);\n\t\treturn this;\n\t}\n\n\tseek(obj) {\n\t\tlet arg       = obj || {};\n\t\tlet g         = arg.g || this._gravityPoints[this._currentGPointNum].g;\n\t\tlet direction = (arg.x && arg.y)? { x: arg.x, y: arg.y } : this._gravityPoints[this._currentGPointNum].pos;\n\t\tlet sub       = Vector.sub(direction, this._location);\n\t\tlet normal    = Vector.normalize(sub);\n\t\tlet force     = Vector.mult(normal, g);\n\t\tthis.applyForce(force);\n\t}\n\n\tarrive(arg) {\n\t\tlet gPoint  = this._gravityPoints[this._currentGPointNum];\n\t\tlet sub     = Vector.sub(gPoint.pos, this._location);\n\t\tlet diff    = Vector.mag(sub);\n\t\tlet normal  = Vector.normalize(sub);\n\t\tlet desired = { x: 0, y: 0 };\n\t\tlet steer   = { x: 0, y: 0 };\n\n\t\tif(diff < this._gravDistance) {\n\t\t\tlet isNextPoint = (this._gravityPoints.length - 1 > this._currentGPointNum)? true : false;\n\t\t\tlet mapedScalar = this._minspeed;\n\n\t\t\tif(isNextPoint) {\n\t\t\t\tthis._currentGPointNum += 1;\n\t\t\t\tthis._acceleration      = { x: 0, y: 0 };\n\t\t\t}\n\t\t\telse if(this._infinity) {\n\t\t\t\tconsole.log('infinity')\n\t\t\t\tthis._currentGPointNum = 0;\n\t\t\t\tthis._acceleration     = { x: 0, y: 0 };\n\t\t\t} else {\n\t\t\t\tmapedScalar = this.map(diff, 0, this._gravDistance, 0, 4);\n\t\t\t}\n\n\t\t\tdesired = Vector.mult(normal, mapedScalar);\n\t\t\tsteer   = Vector.sub(desired, this._velocity);\n\t\t\tthis.applyForce(steer);\n\n\t\t\tif(!this._isAnimationEnd && Vector.mag(sub) < 1) {\n\t\t\t\tthis._isAnimationEnd = true;\n\t\t\t\tgPoint.callback(this);\n\t\t\t\tdispatchEvent(this._el, 'moveEnd');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.seek();\n\t\t}\n\t}\n\n\tgetPoint() {\n\t\tlet prop = { x: this._location.x, y: this._location.y };\n\t\treturn prop;\n\t}\n\t//値を規制\n\tmap(value, low1, high1, low2, high2) {\n\t\tlet moto = high1 - low1;\n\t\tlet ato  = high2 - low2;\n\t\treturn (ato / moto) * value;\n\t}\n\n\tshowGravityPoints() {\n\t\tlet stage = document.getElementById(this._stageId);\n\t\tthis._gravityPoints.forEach( (v, i) => {\n\t\t\tlet gcolor = this._showGravityPointsColor;\n\t\t\tlet color  = (gcolor)? gcolor : '#000';\n\t\t\tlet div    = document.createElement('div');\n\t\t\tdiv.appendChild(document.createTextNode(i));\n\t\t\tdiv.style.backgroundColor = color;\n\t\t\tdiv.style.position        = 'absolute';\n\t\t\tdiv.style.left            = v.pos.x + 'px';\n\t\t\tdiv.style.top             = v.pos.y + 'px';\n\t\t\tdiv.style.width           = '20px';\n\t\t\tdiv.style.height          = '20px';\n\t\t\tdiv.style.lineHeight      = '20px';\n\t\t\tdiv.style.color           = '#fff';\n\t\t\tdiv.style.textAlign       = 'center';\n\t\t\tstage.appendChild(div);\n\t\t} );\n\t}\n}\n","import VectorAnimation from './modules/VectorAnimation.js';\n\n(function() {\n\tvar timer = {};\n\tvar el  = document.querySelector('.thing');\n\tvar el2 = document.querySelector('.thing2');\n\tvar el3 = document.querySelector('.thing3');\n\tvar elStyle = el.style;\n\tvar el2Style = el2.style;\n\tvar el3Style = el3.style;\n\tvar callback = function(e) { console.log(e); }\n\tvar gPoints = [ \n\t\t\t\t\t{ pos : { x: 300, y: 300 } , g : 1.0, mass : 10, minspeed : 4.0, callback : callback },\n\t\t\t\t\t{ pos : { x: 30,  y: 200 } , g : 1.0, mass : 20, minspeed : 1.8, callback : callback },\n\t\t\t\t\t{ pos : { x: 330, y: 100 } , g : 1.0, mass : 40, minspeed : 1.8, callback : callback }\n\t\t\t\t];\n\tvar things = [];\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tel : el,\n\t\t\tstageId       : 'stage',\n\t\t\tlocation      : { x: 100, y: 100 },\n\t\t\tgravityPoints : gPoints,\n\t\t\tgravDistance  : 140,\n\t\t\tinfinity      : true\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId                : 'stage',\n\t\t\tlocation               : { x: 200, y: 200 },\n\t\t\tshowGravityPointsColor : '#0f0',\n\t\t\tgravityPoints : [\n\t\t\t\t{ pos: { x: 100, y: 100 }, g: 1, callback: callback }\n\t\t\t],\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId                : 'stage',\n\t\t\tlocation               : { x: 100, y: 100 },\n\t\t\tshowGravityPointsColor : '#00f',\n\t\t\tgravityPoints          : [ { pos: { x: 400, y: 100 }, g: 1, callback: callback } ]\n\t\t})\n\t);\n\n\tthings.forEach( (v, i) => {\n\t\tv.showGravityPoints();\n\t\tconsole.log(v.el)\n\t\tconsole.log(v.stageId)\n\t\tconsole.log(v.currentGPointNum)\n\t});\n\n\tel.addEventListener('moveEnd', function(e) {\n\t\tconsole.log('move end');\n\t});\n\n\tfunction loop() {\n\t\tfor(var i = 0; i < things.length; i++) {\n\t\t\tif(i == 0) {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\telStyle.left = pos.x + 'px';\n\t\t\t\telStyle.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse if(i == 1) {\n\t\t\t\tthings[i].seek();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel2Style.left = pos.x + 'px';\n\t\t\t\tel2Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel3Style.left = pos.x + 'px';\n\t\t\t\tel3Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t}\n\n\t\twindow.requestAnimationFrame(loop);\n\t}\n\n\trequestAnimationFrame(loop);\n\n})();"],"names":["Vector","v1","v2","x","y","v","n","m","this","mag","div","Math","sqrt","el","event","document","createEvent","evt","initEvent","dispatchEvent","createEventObject","fireEvent","VectorAnimation","arg","Error","_el","querySelector","_stageId","stageId","_location","location","_friction","friction","_velocity","_acceleration","_mass","mass","_maxspeed","maxspeed","_minspeed","minspeed","_damage","damage","_gravDistance","gravDistance","_gravityPoints","gravityPoints","_currentGPointNum","_showGravityPointsColor","showGravityPointsColor","_isAnimationEnd","_infinity","infinity","add","mult","force","obj","g","direction","pos","sub","normal","normalize","applyForce","gPoint","diff","desired","steer","isNextPoint","length","mapedScalar","console","log","map","callback","seek","value","low1","high1","low2","high2","stage","getElementById","forEach","i","gcolor","_this","color","createElement","appendChild","createTextNode","style","backgroundColor","position","left","top","width","height","lineHeight","textAlign","num","bool","e","el2","el3","elStyle","el2Style","el3Style","gPoints","things","push","showGravityPoints","currentGPointNum","addEventListener","requestAnimationFrame","loop","arrive","update","getPoint","window"],"mappings":"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"}