{"version":3,"file":"sample.js","sources":["../src/modules/Vector.js","../src/modules/dispatchEvent.js","../src/modules/VectorAnimation.js","../src/sample.js"],"sourcesContent":["export default class Vector {\n\tstatic add(v1, v2) {\n\t\tx = v1.x + v2.x;\n\t\ty = v1.y + v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic sub(v1, v2) {\n\t\tx = v1.x - v2.x;\n\t\ty = v1.y - v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic mult(v, n) {\n\t\tx = v.x * n;\n\t\ty = v.y * n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic div(v, n) {\n\t\tx = v.x / n;\n\t\ty = v.y / n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic normalize(v) {\n\t\tvar m = this.mag(v);\n\t\tif(m !== 0) {\n\t\t\treturn this.div(v, m);\n\t\t} else {\n\t\t\treturn v;\n\t\t}\n\t}\n\tstatic mag(v) {\n\t\treturn Math.sqrt(v.x * v.x + v.y * v.y);\n\t}\n};","export default function(el, event){\n\tif (document.createEvent) {\n\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\t\tevt.initEvent(event, true, true );\n\t\treturn el.dispatchEvent(evt);\n\t} else {\n\t\tvar evt = document.createEventObject();\n\t\treturn el.fireEvent(\"on\" + event, evt)\n\t}\n};\n","import Vector from './Vector.js';\nimport dispatchEvent from './dispatchEvent.js';\n\nexport default class VectorAnimation {\n\n\tconstructor(arg) {\n\t\tif(!arg) {\n\t\t\tthrow new Error('please argments 引数は必須です');\n\t\t}\n\t\tthis.el                     = arg.el || document.querySelector('body');\n\t\tthis.stageId                = arg.stageId;\n\t\tthis.location               = (arg.location)? arg.location : { x: 0, y: 0 },\n\t\tthis.friction               = arg.friction || 0.9,\n\t\tthis.velocity               = { x: 0, y: 0 },\n\t\tthis.acceleration           = { x: 0, y: 0 },\n\t\tthis.mass                   = arg.mass || 10,\n\t\tthis.maxspeed               = arg.maxspeed || 10,\n\t\tthis.minspeed               = arg.minspeed || 2.8;\n\t\tthis.damage                 = arg.damage || 0.98,\n\t\tthis.gravDistance           = arg.gravDistance || 100;\n\t\tthis.gravityPoints          = arg.gravityPoints || {};\n\t\tthis.currentGPointNum       = 0;\n\t\tthis.vector                 = Vector;\n\t\tthis.showGravityPointsColor = arg.showGravityPointsColor;\n\n\t\tthis.gravityPoints.forEach((v, i) => {\n\t\t\tv.isAnimationEnd = false;\n\t\t});\n\n\t\tconsole.log(this.gravDistance)\n\t}\n\n\tdraw() {\n\t\treturn this;\n\t}\n\n\tupdate() {\n\t    this.velocity     = this.vector.add(this.velocity, this.acceleration);\n\t    this.velocity     = this.vector.mult(this.velocity, this.damage);\n\t    this.location     = this.vector.add(this.location, this.velocity);\n\t    this.acceleration = this.vector.mult(this.acceleration, 0);\n\t\treturn this;\n\t}\n\n\tapplyForce(force) {\n\t\tforce = this.vector.div(force, this.mass);\n\t\tthis.acceleration = this.vector.add(this.acceleration, force);\n\t\treturn this;\n\t}\n\n\tseek(obj) {\n\t\tlet arg       = obj || {};\n\t\tlet g         = arg.g || this.gravityPoints[this.currentGPointNum].g;\n\t\tlet direction = (arg.x && arg.y)? { x: arg.x, y: arg.y } : this.gravityPoints[this.currentGPointNum].pos;\n\t\tlet sub       = this.vector.sub(direction, this.location);\n\t\tlet normal    = this.vector.normalize(sub);\n\t\tlet force     = this.vector.mult(normal, g);\n\t\tthis.applyForce(force);\n\t}\n\n\tarrive(arg) {\n\t\tlet gPoint  = this.gravityPoints[this.currentGPointNum];\n\t\tlet sub     = this.vector.sub(gPoint.pos, this.location);\n\t\tlet diff    = this.vector.mag(sub);\n\t\tlet normal  = this.vector.normalize(sub);\n\t\tlet desired = { x: 0, y: 0 };\n\t\tlet steer   = { x: 0, y: 0 };\n\n\t\tif(diff < this.gravDistance) {\n\t\t\tlet isNextPoint = (this.gravityPoints.length - 1 > this.currentGPointNum)? true : false;\n\t\t\tlet mapedScalar = this.minspeed;\n\n\t\t\tif(isNextPoint) {\n\t\t\t\tthis.currentGPointNum += 1;\n\t\t\t\tthis.acceleration      = { x: 0, y: 0 };\n\t\t\t} else {\n\t\t\t\tmapedScalar = this.map(diff, 0, this.gravDistance, 0, 4);\n\t\t\t}\n\n\t\t\tdesired = this.vector.mult(normal, mapedScalar);\n\t\t\tsteer   = this.vector.sub(desired, this.velocity);\n\t\t\tthis.applyForce(steer);\n\n\t\t\tif(!gPoint.isAnimationEnd && this.vector.mag(sub) < 1) {\n\t\t\t\tgPoint.isAnimationEnd = true;\n\t\t\t\tgPoint.callback(this);\n\t\t\t\tdispatchEvent(this.el, 'moveEnd');\n\t\t\t}\n\t\t} else {\n\t\t\tthis.seek();\n\t\t}\n\t}\n\n\tgetPoint() {\n\t\tlet prop = { x: this.location.x, y: this.location.y };\n\t\treturn prop;\n\t}\n\t//値を規制\n\tmap(value, low1, high1, low2, high2) {\n\t\tlet moto = high1 - low1;\n\t\tlet ato  = high2 - low2;\n\t\treturn (ato / moto) * value;\n\t}\n\n\tshowGravityPoints() {\n\t\tlet stage = document.getElementById(this.stageId);\n\t\tthis.gravityPoints.forEach( (v, i) => {\n\t\t\tlet gcolor = this.showGravityPointsColor;\n\t\t\tlet color  = (gcolor)? gcolor : '#000';\n\t\t\tlet div    = document.createElement('div');\n\t\t\tdiv.appendChild(document.createTextNode(i));\n\t\t\tdiv.style.backgroundColor = color;\n\t\t\tdiv.style.position        = 'absolute';\n\t\t\tdiv.style.left            = v.pos.x + 'px';\n\t\t\tdiv.style.top             = v.pos.y + 'px';\n\t\t\tdiv.style.width           = '20px';\n\t\t\tdiv.style.height          = '20px';\n\t\t\tdiv.style.lineHeight      = '20px';\n\t\t\tdiv.style.color           = '#fff';\n\t\t\tdiv.style.textAlign       = 'center';\n\t\t\tstage.appendChild(div);\n\t\t} );\n\t}\n}\n","import VectorAnimation from './modules/VectorAnimation.js';\n\n(function() {\n\tvar timer = {};\n\tvar el = document.querySelector('.thing');\n\tvar el2 = document.querySelector('.thing2');\n\tvar el3 = document.querySelector('.thing3');\n\tvar elStyle = el.style;\n\tvar el2Style = el2.style;\n\tvar el3Style = el3.style;\n\tvar callback = function(e) { console.log(\"e\"); }\n\tvar gPoints = [ \n\t\t\t\t\t{ pos : { x: 300, y: 300 } , g : 1.5, mass : 10, minspeed : 4.0, callback : callback },\n\t\t\t\t\t{ pos : { x: 300, y: 200 } , g : 0.5, mass : 20, minspeed : 1.8, callback : callback },\n\t\t\t\t\t{ pos : { x: 330, y: 100 } , g : 0.5, mass : 40, minspeed : 1.8, callback : callback }\n\t\t\t\t];\n\tvar things = [];\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tel : el,\n\t\t\tstageId       : 'stage',\n\t\t\tlocation      : { x: 100, y: 100 },\n\t\t\tgravityPoints : gPoints,\n\t\t\tgravDistance  : 140\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId                : 'stage',\n\t\t\tlocation               : { x: 200, y: 200 },\n\t\t\tshowGravityPointsColor : '#0f0',\n\t\t\tgravityPoints : [\n\t\t\t\t{ pos: { x: 100, y: 100 }, g: 1, callback: callback }\n\t\t\t],\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId                : 'stage',\n\t\t\tlocation               : { x: 100, y: 100 },\n\t\t\tshowGravityPointsColor : '#00f',\n\t\t\tgravityPoints          : [ { pos: { x: 400, y: 100 }, g: 1, callback: callback } ]\n\t\t})\n\t);\n\n\tthings.forEach( (v, i) => {\n\t\tv.showGravityPoints();\n\t});\n\n\tel.addEventListener('moveEnd', function(e) {\n\t\tconsole.log('move end')\n\t});\n\n\tfunction loop() {\n\t\tfor(var i = 0; i < things.length; i++) {\n\t\t\tif(i == 0) {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\telStyle.left = pos.x + 'px';\n\t\t\t\telStyle.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse if(i == 1) {\n\t\t\t\tthings[i].seek();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel2Style.left = pos.x + 'px';\n\t\t\t\tel2Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel3Style.left = pos.x + 'px';\n\t\t\t\tel3Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t}\n\n\t\twindow.requestAnimationFrame(loop);\n\t}\n\n\trequestAnimationFrame(loop);\n\n})();"],"names":["Vector","v1","v2","x","y","v","n","m","this","mag","div","Math","sqrt","el","event","document","createEvent","evt","initEvent","dispatchEvent","createEventObject","fireEvent","VectorAnimation","arg","Error","querySelector","stageId","location","friction","velocity","acceleration","mass","maxspeed","minspeed","damage","gravDistance","gravityPoints","currentGPointNum","vector","showGravityPointsColor","forEach","i","isAnimationEnd","console","log","add","mult","force","obj","g","direction","pos","sub","normal","normalize","applyForce","gPoint","diff","desired","steer","isNextPoint","length","mapedScalar","map","callback","seek","value","low1","high1","low2","high2","stage","getElementById","gcolor","_this","color","createElement","appendChild","createTextNode","style","backgroundColor","position","left","top","width","height","lineHeight","textAlign","e","el2","el3","elStyle","el2Style","el3Style","gPoints","things","push","showGravityPoints","addEventListener","requestAnimationFrame","loop","arrive","update","getPoint","window"],"mappings":"0YAAqBA,6GACTC,EAAIC,UACdC,EAAIF,EAAGE,EAAID,EAAGC,EACdC,EAAIH,EAAGG,EAAIF,EAAGE,EACP,CAACD,EAAGA,EAAGC,EAAGA,+BAEPH,EAAIC,UACdC,EAAIF,EAAGE,EAAID,EAAGC,EACdC,EAAIH,EAAGG,EAAIF,EAAGE,EACP,CAACD,EAAGA,EAAGC,EAAGA,gCAENC,EAAGC,UACdH,EAAIE,EAAEF,EAAIG,EACVF,EAAIC,EAAED,EAAIE,EACH,CAACH,EAAGA,EAAGC,EAAGA,+BAEPC,EAAGC,UACbH,EAAIE,EAAEF,EAAIG,EACVF,EAAIC,EAAED,EAAIE,EACH,CAACH,EAAGA,EAAGC,EAAGA,qCAEDC,OACZE,EAAIC,KAAKC,IAAIJ,UACR,IAANE,EACKC,KAAKE,IAAIL,EAAGE,GAEZF,8BAGEA,UACHM,KAAKC,KAAKP,EAAEF,EAAIE,EAAEF,EAAIE,EAAED,EAAIC,EAAED,mCC9BfS,EAAIC,MACvBC,SAASC,mBACRC,EAAMF,SAASC,YAAY,eAC3BE,UAAUJ,GAAO,GAAM,GACpBD,EAAGM,cAAcF,OAEpBA,EAAMF,SAASK,2BACZP,EAAGQ,UAAU,KAAOP,EAAOG,OCJfK,sCAERC,+BACPA,QACG,IAAIC,MAAM,gCAEZX,GAAyBU,EAAIV,IAAME,SAASU,cAAc,aAC1DC,QAAyBH,EAAIG,aAC7BC,SAA0BJ,EAAII,SAAWJ,EAAII,SAAW,CAAExB,EAAG,EAAGC,EAAG,GACxEI,KAAKoB,SAAyBL,EAAIK,UAAY,GAC9CpB,KAAKqB,SAAyB,CAAE1B,EAAG,EAAGC,EAAG,GACzCI,KAAKsB,aAAyB,CAAE3B,EAAG,EAAGC,EAAG,GACzCI,KAAKuB,KAAyBR,EAAIQ,MAAQ,GAC1CvB,KAAKwB,SAAyBT,EAAIS,UAAY,GAC9CxB,KAAKyB,SAAyBV,EAAIU,UAAY,SACzCC,OAAyBX,EAAIW,QAAU,IAC5C1B,KAAK2B,aAAyBZ,EAAIY,cAAgB,SAC7CC,cAAyBb,EAAIa,eAAiB,QAC9CC,iBAAyB,OACzBC,OAAyBtC,YACzBuC,uBAAyBhB,EAAIgB,4BAE7BH,cAAcI,QAAQ,SAACnC,EAAGoC,GAC9BpC,EAAEqC,gBAAiB,IAGpBC,QAAQC,IAAIpC,KAAK2B,yEAIV3B,kDAICqB,SAAerB,KAAK8B,OAAOO,IAAIrC,KAAKqB,SAAUrB,KAAKsB,mBACnDD,SAAerB,KAAK8B,OAAOQ,KAAKtC,KAAKqB,SAAUrB,KAAK0B,aACpDP,SAAenB,KAAK8B,OAAOO,IAAIrC,KAAKmB,SAAUnB,KAAKqB,eACnDC,aAAetB,KAAK8B,OAAOQ,KAAKtC,KAAKsB,aAAc,GACpDtB,wCAGGuC,UACVA,EAAQvC,KAAK8B,OAAO5B,IAAIqC,EAAOvC,KAAKuB,WAC/BD,aAAetB,KAAK8B,OAAOO,IAAIrC,KAAKsB,aAAciB,GAChDvC,kCAGHwC,OACAzB,EAAYyB,GAAO,GACnBC,EAAY1B,EAAI0B,GAAKzC,KAAK4B,cAAc5B,KAAK6B,kBAAkBY,EAC/DC,EAAa3B,EAAIpB,GAAKoB,EAAInB,EAAI,CAAED,EAAGoB,EAAIpB,EAAGC,EAAGmB,EAAInB,GAAMI,KAAK4B,cAAc5B,KAAK6B,kBAAkBc,IACjGC,EAAY5C,KAAK8B,OAAOc,IAAIF,EAAW1C,KAAKmB,UAC5C0B,EAAY7C,KAAK8B,OAAOgB,UAAUF,GAClCL,EAAYvC,KAAK8B,OAAOQ,KAAKO,EAAQJ,QACpCM,WAAWR,kCAGVxB,OACFiC,EAAUhD,KAAK4B,cAAc5B,KAAK6B,kBAClCe,EAAU5C,KAAK8B,OAAOc,IAAII,EAAOL,IAAK3C,KAAKmB,UAC3C8B,EAAUjD,KAAK8B,OAAO7B,IAAI2C,GAC1BC,EAAU7C,KAAK8B,OAAOgB,UAAUF,GAChCM,EAAU,CAAEvD,EAAG,EAAGC,EAAG,GACrBuD,EAAU,CAAExD,EAAG,EAAGC,EAAG,MAEtBqD,EAAOjD,KAAK2B,aAAc,KACxByB,EAAepD,KAAK4B,cAAcyB,OAAS,EAAIrD,KAAK6B,iBACpDyB,EAActD,KAAKyB,SAEpB2B,QACGvB,kBAAoB,OACpBP,aAAoB,CAAE3B,EAAG,EAAGC,EAAG,IAEpC0D,EAActD,KAAKuD,IAAIN,EAAM,EAAGjD,KAAK2B,aAAc,EAAG,GAGvDuB,EAAUlD,KAAK8B,OAAOQ,KAAKO,EAAQS,GACnCH,EAAUnD,KAAK8B,OAAOc,IAAIM,EAASlD,KAAKqB,eACnC0B,WAAWI,IAEZH,EAAOd,gBAAkBlC,KAAK8B,OAAO7B,IAAI2C,GAAO,IACnDI,EAAOd,gBAAiB,EACxBc,EAAOQ,SAASxD,MAChBW,cAAcX,KAAKK,GAAI,sBAGnBoD,gDAKK,CAAE9D,EAAGK,KAAKmB,SAASxB,EAAGC,EAAGI,KAAKmB,SAASvB,+BAI/C8D,EAAOC,EAAMC,EAAOC,EAAMC,UAElBA,EAAQD,IADRD,EAAQD,GAEGD,yDAIlBK,EAAQxD,SAASyD,eAAehE,KAAKkB,cACpCU,cAAcI,QAAS,SAACnC,EAAGoC,OAC3BgC,EAASC,EAAKnC,uBACdoC,EAAUF,GAAkB,OAC5B/D,EAASK,SAAS6D,cAAc,OACpClE,EAAImE,YAAY9D,SAAS+D,eAAerC,IACxC/B,EAAIqE,MAAMC,gBAAkBL,EAC5BjE,EAAIqE,MAAME,SAAkB,WAC5BvE,EAAIqE,MAAMG,KAAkB7E,EAAE8C,IAAIhD,EAAI,KACtCO,EAAIqE,MAAMI,IAAkB9E,EAAE8C,IAAI/C,EAAI,KACtCM,EAAIqE,MAAMK,MAAkB,OAC5B1E,EAAIqE,MAAMM,OAAkB,OAC5B3E,EAAIqE,MAAMO,WAAkB,OAC5B5E,EAAIqE,MAAMJ,MAAkB,OAC5BjE,EAAIqE,MAAMQ,UAAkB,SAC5BhB,EAAMM,YAAYnE,0BC9GL,SAAXsD,EAAoBwB,GAAK7C,QAAQC,IAAI,SANrC/B,EAAKE,SAASU,cAAc,UAC5BgE,EAAM1E,SAASU,cAAc,WAC7BiE,EAAM3E,SAASU,cAAc,WAC7BkE,EAAU9E,EAAGkE,MACba,EAAWH,EAAIV,MACfc,EAAWH,EAAIX,MAEfe,EAAU,CACV,CAAE3C,IAAM,CAAEhD,EAAG,IAAKC,EAAG,KAAQ6C,EAAI,IAAKlB,KAAO,GAAIE,SAAW,EAAK+B,SAAWA,GAC5E,CAAEb,IAAM,CAAEhD,EAAG,IAAKC,EAAG,KAAQ6C,EAAI,GAAKlB,KAAO,GAAIE,SAAW,IAAK+B,SAAWA,GAC5E,CAAEb,IAAM,CAAEhD,EAAG,IAAKC,EAAG,KAAQ6C,EAAI,GAAKlB,KAAO,GAAIE,SAAW,IAAK+B,SAAWA,IAE5E+B,EAAS,GAEbA,EAAOC,KAAM,IAAI1E,gBAChB,CACCT,GAAKA,EACLa,QAAgB,QAChBC,SAAgB,CAAExB,EAAG,IAAKC,EAAG,KAC7BgC,cAAgB0D,EAChB3D,aAAgB,OAIlB4D,EAAOC,KAAM,IAAI1E,gBAChB,CACCI,QAAyB,QACzBC,SAAyB,CAAExB,EAAG,IAAKC,EAAG,KACtCmC,uBAAyB,OACzBH,cAAgB,CACf,CAAEe,IAAK,CAAEhD,EAAG,IAAKC,EAAG,KAAO6C,EAAG,EAAGe,SAAUA,OAK9C+B,EAAOC,KAAM,IAAI1E,gBAChB,CACCI,QAAyB,QACzBC,SAAyB,CAAExB,EAAG,IAAKC,EAAG,KACtCmC,uBAAyB,OACzBH,cAAyB,CAAE,CAAEe,IAAK,CAAEhD,EAAG,IAAKC,EAAG,KAAO6C,EAAG,EAAGe,SAAUA,OAIxE+B,EAAOvD,QAAS,SAACnC,EAAGoC,GACnBpC,EAAE4F,sBAGHpF,EAAGqF,iBAAiB,UAAW,SAASV,GACvC7C,QAAQC,IAAI,cA4BbuD,+BAzBSC,QACJ,IAAI3D,EAAI,EAAGA,EAAIsD,EAAOlC,OAAQpB,OACzB,GAALA,EAAQ,CACVsD,EAAOtD,GAAG4D,aACNlD,EAAM4C,EAAOtD,GAAG6D,SAASC,WAC7BZ,EAAQT,KAAO/B,EAAIhD,EAAI,KACvBwF,EAAQR,IAAOhC,EAAI/C,EAAI,UAEX,GAALqC,GACPsD,EAAOtD,GAAGwB,OACNd,EAAM4C,EAAOtD,GAAG6D,SAASC,WAC7BX,EAASV,KAAO/B,EAAIhD,EAAI,KACxByF,EAAST,IAAOhC,EAAI/C,EAAI,OAGxB2F,EAAOtD,GAAG4D,SACNlD,EAAM4C,EAAOtD,GAAG6D,SAASC,WAC7BV,EAASX,KAAO/B,EAAIhD,EAAI,KACxB0F,EAASV,IAAOhC,EAAI/C,EAAI,MAI1BoG,OAAOL,sBAAsBC"}