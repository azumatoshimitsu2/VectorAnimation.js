function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var Vector=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"add",value:function(t,e){return x=t.x+e.x,y=t.y+e.y,{x:x,y:y}}},{key:"sub",value:function(t,e){return x=t.x-e.x,y=t.y-e.y,{x:x,y:y}}},{key:"mult",value:function(t,e){return x=t.x*e,y=t.y*e,{x:x,y:y}}},{key:"div",value:function(t,e){return x=t.x/e,y=t.y/e,{x:x,y:y}}},{key:"normalize",value:function(t){var e=this.mag(t);return 0!==e?this.div(t,e):t}},{key:"mag",value:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)}}]),t}();function dispatchEvent(t,e){if(document.createEvent)return(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),t.dispatchEvent(i);var i=document.createEventObject();return t.fireEvent("on"+e,i)}var VectorAnimation=function(){function e(t){if(_classCallCheck(this,e),!t)throw new Error("argments required. 引数は必須です");this._el=t.el||document.querySelector("body"),this._stageId=t.stageId,this._location=t.location?t.location:{x:0,y:0},this._friction=t.friction||.9,this._velocity={x:0,y:0},this._acceleration={x:0,y:0},this._mass=t.mass||10,this._maxspeed=t.maxspeed||10,this._minspeed=t.minspeed||2.8,this._damage=t.damage||.98,this._gravDistance=t.gravDistance||100,this._gravityPoints=t.gravityPoints||{},this._currentGPointNum=0,this._showGravityPointsColor=t.showGravityPointsColor,this._isAnimationEnd=!1,this._infinity=t.infinity||!1}return _createClass(e,[{key:"draw",value:function(){return this}},{key:"update",value:function(){return this._velocity=Vector.add(this._velocity,this._acceleration),this._velocity=Vector.mult(this._velocity,this._damage),this._location=Vector.add(this._location,this._velocity),this._acceleration=Vector.mult(this._acceleration,0),this}},{key:"applyForce",value:function(t){return t=Vector.div(t,this._mass),this._acceleration=Vector.add(this._acceleration,t),this}},{key:"seek",value:function(t){var e=t||{},i=e.g||this._gravityPoints[this._currentGPointNum].g,n=e.x&&e.y?{x:e.x,y:e.y}:this._gravityPoints[this._currentGPointNum].pos,o=Vector.sub(n,this._location),s=Vector.normalize(o),r=Vector.mult(s,i);this.applyForce(r)}},{key:"arrive",value:function(t){var e=this._gravityPoints[this._currentGPointNum],i=Vector.sub(e.pos,this._location),n=Vector.mag(i),o=Vector.normalize(i),s={x:0,y:0},r={x:0,y:0};if(n<this._gravDistance){var a=this._gravityPoints.length-1>this._currentGPointNum,c=this._minspeed;a?(this._currentGPointNum+=1,this._acceleration={x:0,y:0}):this._infinity?(console.log("infinity"),this._currentGPointNum=0,this._acceleration={x:0,y:0}):c=this.map(n,0,this._gravDistance,0,4),s=Vector.mult(o,c),r=Vector.sub(s,this._velocity),this.applyForce(r),!this._isAnimationEnd&&Vector.mag(i)<1&&(this._isAnimationEnd=!0,e.callback(this),dispatchEvent(this._el,"moveEnd"))}else this.seek()}},{key:"getPoint",value:function(){return{x:this._location.x,y:this._location.y}}},{key:"map",value:function(t,e,i,n,o){return(o-n)/(i-e)*t}},{key:"showGravityPoints",value:function(){var s=this,r=document.getElementById(this._stageId);this._gravityPoints.forEach(function(t,e){var i=s._showGravityPointsColor,n=i||"#000",o=document.createElement("div");o.appendChild(document.createTextNode(e)),o.style.backgroundColor=n,o.style.position="absolute",o.style.left=t.pos.x+"px",o.style.top=t.pos.y+"px",o.style.width="20px",o.style.height="20px",o.style.lineHeight="20px",o.style.color="#fff",o.style.textAlign="center",r.appendChild(o)})}},{key:"el",get:function(){return this._el}},{key:"stageId",get:function(){return this._stageId}},{key:"currentGPointNum",get:function(){return this._currentGPointNum},set:function(t){this._currentGPointNum=t}},{key:"isAnimationEnd",get:function(){return this._isAnimationEnd},set:function(t){this._isAnimationEnd=t}}]),e}();!function(){function t(t){console.log(t)}var e=document.querySelector(".thing"),i=document.querySelector(".thing2"),n=document.querySelector(".thing3"),o=e.style,s=i.style,r=n.style,a=[{pos:{x:300,y:300},g:1,mass:10,minspeed:4,callback:t},{pos:{x:30,y:200},g:1,mass:20,minspeed:1.8,callback:t},{pos:{x:330,y:100},g:1,mass:40,minspeed:1.8,callback:t}],c=[];c.push(new VectorAnimation({el:e,stageId:"stage",location:{x:100,y:100},gravityPoints:a,gravDistance:140,infinity:!0})),c.push(new VectorAnimation({stageId:"stage",location:{x:200,y:200},showGravityPointsColor:"#0f0",gravityPoints:[{pos:{x:100,y:100},g:1,callback:t}]})),c.push(new VectorAnimation({stageId:"stage",location:{x:100,y:100},showGravityPointsColor:"#00f",gravityPoints:[{pos:{x:400,y:100},g:1,callback:t}]})),c.forEach(function(t,e){t.showGravityPoints(),console.log(t.el),console.log(t.stageId),console.log(t.currentGPointNum)}),e.addEventListener("moveEnd",function(t){console.log("move end")}),requestAnimationFrame(function t(){for(var e=0;e<c.length;e++)if(0==e){c[e].arrive();var i=c[e].update().getPoint();o.left=i.x+"px",o.top=i.y+"px"}else 1==e?(c[e].seek(),i=c[e].update().getPoint(),s.left=i.x+"px",s.top=i.y+"px"):(c[e].arrive(),i=c[e].update().getPoint(),r.left=i.x+"px",r.top=i.y+"px");window.requestAnimationFrame(t)})}();//# sourceMappingURL=sample.js.map
