{"version":3,"file":"sample.js","sources":["../src/modules/Vector.js","../src/modules/VectorAnimation.js","../src/sample.js"],"sourcesContent":["export default class Vector {\n\tstatic add(v1, v2) {\n\t\tx = v1.x + v2.x;\n\t\ty = v1.y + v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic sub(v1, v2) {\n\t\tx = v1.x - v2.x;\n\t\ty = v1.y - v2.y;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic mult(v, n) {\n\t\tx = v.x * n;\n\t\ty = v.y * n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic div(v, n) {\n\t\tx = v.x / n;\n\t\ty = v.y / n;\n\t\treturn {x: x, y: y};\n\t}\n\tstatic normalize(v) {\n\t\tvar m = this.mag(v);\n\t\tif(m !== 0) {\n\t\t\treturn this.div(v, m);\n\t\t} else {\n\t\t\treturn v;\n\t\t}\n\t}\n\tstatic mag(v) {\n\t\treturn Math.sqrt(v.x * v.x + v.y * v.y);\n\t}\n};","import Vector from './Vector.js';\n\nexport default class VectorAnimation {\n\n\tconstructor(arg) {\n\t\tif(!arg) {\n\t\t\tthrow new Error('please argments 引数は必須です');\n\t\t}\n\t\tthis.stageId                = arg.stageId;\n\t\tthis.location               = (arg.location)? arg.location : { x: 0, y: 0 },\n\t\tthis.friction               = arg.friction || 0.9,\n\t\tthis.velocity               = { x: 0, y: 0 },\n\t\tthis.acceleration           = { x: 0, y: 0 },\n\t\tthis.mass                   = arg.mass || 10,\n\t\tthis.maxspeed               = arg.maxspeed || 10,\n\t\tthis.minspeed               = arg.minspeed || 2.8;\n\t\tthis.damage                 = arg.damage || 0.98,\n\t\tthis.rad                    = arg.rad || 100;\n\t\tthis.gravityPoints          = arg.gravityPoints || {};\n\t\tthis.currentGPointNum       = 0;\n\t\tthis.vector                 = Vector;\n\t\tthis.showGravityPointsColor = arg.showGravityPointsColor;\n\n\t\tthis.gravityPoints.forEach((v, i) => {\n\t\t\tv.isAnimationEnd = false;\n\t\t});\n\t}\n\n\tdraw() {\n\t\treturn this;\n\t}\n\n\tupdate() {\n\t    this.velocity     = this.vector.add(this.velocity, this.acceleration);\n\t    this.velocity     = this.vector.mult(this.velocity, this.damage);\n\t    this.location     = this.vector.add(this.location, this.velocity);\n\t    this.acceleration = this.vector.mult(this.acceleration, 0);\n\t\treturn this;\n\t}\n\n\tapplyForce(force) {\n\t\tforce = this.vector.div(force, this.mass);\n\t\tthis.acceleration = this.vector.add(this.acceleration, force);\n\t\treturn this;\n\t}\n\n\tseek(obj) {\n\t\tlet arg       = obj || {};\n\t\tlet g         = arg.g || this.gravityPoints[this.currentGPointNum].g;\n\t\tlet direction = (arg.x && arg.y)? { x: arg.x, y: arg.y } : this.gravityPoints[this.currentGPointNum].pos;\n\t\tlet sub       = this.vector.sub(direction, this.location);\n\t\tlet normal    = this.vector.normalize(sub);\n\t\tlet force     = this.vector.mult(normal, g);\n\t\tthis.applyForce(force);\n\t}\n\n\tarrive(arg) {\n\t\tlet gPoint  = this.gravityPoints[this.currentGPointNum];\n\t\tlet sub     = this.vector.sub(gPoint.pos, this.location);\n\t\tlet diff    = this.vector.mag(sub);\n\t\tlet normal  = this.vector.normalize(sub);\n\t\tlet desired = { x: 0, y: 0 };\n\t\tlet steer   = { x: 0, y: 0 };\n\n\t\tif(diff < this.rad) {\n\t\t\tlet isNextPoint = false;\n\n\t\t\tif(this.gravityPoints.length - 1 > this.currentGPointNum) {\n\t\t\t\tisNextPoint = true;\n\t\t\t}\n\n\t\t\tlet mapedScalar = this.minspeed;\n\t\t\tif(!isNextPoint) {\n\t\t\t\tmapedScalar = this.map(diff, 0, this.rad, 0, 4);\n\t\t\t}\n\t\t\tdesired = this.vector.mult(normal, mapedScalar);\n\t\t\tsteer   = this.vector.sub(desired, this.velocity);\n\t\t\tthis.applyForce(steer);\n\n\t\t\tif(!gPoint.isAnimationEnd && this.vector.mag(sub) < 1) {\n\t\t\t\tgPoint.isAnimationEnd = true;\n\t\t\t\tgPoint.callback(this);\n\t\t\t\tif(isNextPoint) {\n\t\t\t\t\tthis.currentGPointNum += 1;\n\t\t\t\t\tthis.acceleration      = { x: 0, y: 0 };\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.seek();\n\t\t}\n\t}\n\n\tgetPoint() {\n\t\tlet prop = { x: this.location.x, y: this.location.y };\n\t\treturn prop;\n\t}\n\t//値を規制\n\tmap(value, low1, high1, low2, high2) {\n\t\tlet moto = high1 - low1;\n\t\tlet ato  = high2 - low2;\n\t\treturn (ato / moto) * value;\n\t}\n\n\tshowGravityPoints() {\n\t\tlet stage = document.getElementById(this.stageId);\n\t\tthis.gravityPoints.forEach( (v, i) => {\n\t\t\tlet gcolor = this.showGravityPointsColor;\n\t\t\tlet color  = (gcolor)? gcolor : '#000';\n\t\t\tlet div    = document.createElement('div');\n\t\t\tdiv.appendChild(document.createTextNode(i));\n\t\t\tdiv.style.backgroundColor = color;\n\t\t\tdiv.style.position        = 'absolute';\n\t\t\tdiv.style.left            = v.pos.x + 'px';\n\t\t\tdiv.style.top             = v.pos.y + 'px';\n\t\t\tdiv.style.width           = '20px';\n\t\t\tdiv.style.height          = '20px';\n\t\t\tdiv.style.lineHeight      = '20px';\n\t\t\tdiv.style.color           = '#fff';\n\t\t\tdiv.style.textAlign       = 'center';\n\t\t\tstage.appendChild(div);\n\t\t} );\n\t}\n}\n","import VectorAnimation from './modules/VectorAnimation.js';\n\n(function() {\n\tvar timer = {};\n\tvar el = document.querySelector('.thing');\n\tvar el2 = document.querySelector('.thing2');\n\tvar el3 = document.querySelector('.thing3');\n\tvar elStyle = el.style;\n\tvar el2Style = el2.style;\n\tvar el3Style = el3.style;\n\tvar callback = function(e) { console.log(\"e\"); }\n\tvar gPoints = [ \n\t\t\t\t\t{ pos : { x: 300, y: 300 } , g : 1.5, mass : 10, minspeed : 4.0, callback : callback },\n\t\t\t\t\t{ pos : { x: 300, y: 200 } , g : 0.5, mass : 20, minspeed : 1.8, callback : callback },\n\t\t\t\t\t{ pos : { x: 330, y: 300 } , g : 0.5, mass : 40, minspeed : 1.8, callback : callback }\n\t\t\t\t];\n\tvar things = [];\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId : 'stage',\n\t\t\tlocation : { x: 100, y: 100 },\n\t\t\tgravityPoints : gPoints\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId : 'stage',\n\t\t\tlocation: { x: 200, y: 200 },\n\t\t\tgravityPoints : [\n\t\t\t\t{ pos: { x: 100, y: 100 }, g: 1, callback: callback }\n\t\t\t],\n\t\t\tshowGravityPointsColor : '#0f0'\n\t\t})\n\t);\n\n\tthings.push( new VectorAnimation(\n\t\t{\n\t\t\tstageId : 'stage',\n\t\t\tlocation : { x: 100, y: 100 },\n\t\t\tgravityPoints : [ { pos: { x: 400, y: 100 }, g: 1, callback: callback } ],\n\t\t\tshowGravityPointsColor : '#00f'\n\t\t})\n\t);\n\n\tthings.forEach( (v, i) => {\n\t\t// v.showGravityPoints();\n\t});\n\n\tfunction loop() {\n\t\tfor(var i = 0; i < things.length; i++) {\n\t\t\tif(i == 0) {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\telStyle.left = pos.x + 'px';\n\t\t\t\telStyle.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse if(i == 1) {\n\t\t\t\tthings[i].seek();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel2Style.left = pos.x + 'px';\n\t\t\t\tel2Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthings[i].arrive();\n\t\t\t\tvar pos = things[i].update().getPoint();\n\t\t\t\tel3Style.left = pos.x + 'px';\n\t\t\t\tel3Style.top  = pos.y + 'px';\n\t\t\t}\n\t\t}\n\n\t\twindow.requestAnimationFrame(loop);\n\t}\n\n\trequestAnimationFrame(loop);\n\n})();"],"names":["Vector","v1","v2","x","y","v","n","m","this","mag","div","Math","sqrt","VectorAnimation","arg","Error","stageId","location","friction","velocity","acceleration","mass","maxspeed","minspeed","damage","rad","gravityPoints","currentGPointNum","vector","showGravityPointsColor","forEach","i","isAnimationEnd","add","mult","force","obj","g","direction","pos","sub","normal","normalize","applyForce","gPoint","diff","desired","steer","isNextPoint","length","mapedScalar","map","callback","seek","value","low1","high1","low2","high2","stage","document","getElementById","gcolor","_this","color","createElement","appendChild","createTextNode","style","backgroundColor","position","left","top","width","height","lineHeight","textAlign","e","console","log","el","querySelector","el2","el3","elStyle","el2Style","el3Style","gPoints","things","push","requestAnimationFrame","loop","arrive","update","getPoint","window"],"mappings":"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"}